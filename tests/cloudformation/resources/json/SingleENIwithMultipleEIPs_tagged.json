{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Template Creates a single EC2 instance with a single ENI which has multiple private and public IPs",
  "Parameters":{
  "Subnet": {
      "Description": "ID of the Subnet the instance should be launched in, this will link the instance to the same VPC.",
      "Type": "List<AWS::EC2::Subnet::Id>"
      
    }
},
  "Resources": {
    "EIP1": {
      "Type": "AWS::EC2::EIP",
      "Properties": {
        "Tags": [
          {
            "Key": "new_tag",
            "Value": "new_value"
          },
          {
            "Key": "yor_trace",
            "Value": "1b1a2b1c-8c86-4a0d-b4f1-a5b1ac9b962b"
          }
        ],
        "Domain": "VPC"
      }
    },
    "EIP2": {
      "Type": "AWS::EC2::EIP",
      "Properties": {
        "Tags": [
          {
            "Key": "new_tag",
            "Value": "new_value"
          },
          {
            "Key": "yor_trace",
            "Value": "f4ed35f5-03f3-43a5-8ad4-26b9bf96a44d"
          }
        ],
        "Domain": "VPC"
      }
    },
    "Association1":
    {
   "Type": "AWS::EC2::EIPAssociation",
   "DependsOn" : ["ENI","EIP1"],
   "Properties": {
      "AllocationId": { "Fn::GetAtt" : [ "EIP1", "AllocationId" ]},
      "NetworkInterfaceId": {"Ref":"ENI"},
      "PrivateIpAddress": {"Fn::Select" : [ "0", {"Fn::GetAtt" : [ "ENI" , "SecondaryPrivateIpAddresses"]} ]}
   }
},
"Association2":
    {
   "Type": "AWS::EC2::EIPAssociation",
   "DependsOn" : ["ENI","EIP2"],
   "Properties": {
      "AllocationId": { "Fn::GetAtt" : [ "EIP2", "AllocationId" ]},
       "NetworkInterfaceId": {"Ref":"ENI"},
      "PrivateIpAddress": {"Fn::Select" : [ "1", {"Fn::GetAtt" : [ "ENI" , "SecondaryPrivateIpAddresses"]} ]}
   }
},
 "ENI":
{
   "Type" : "AWS::EC2::NetworkInterface",
   "Properties" : {
      "Tags": [
        {
          "Key": "new_tag",
          "Value": "new_value"
        },
        {
          "Key": "yor_trace",
          "Value": "a4021e41-3e80-4294-8e0c-d15c4f88691c"
        }
      ],
      "SecondaryPrivateIpAddressCount" : 2,
      "SourceDestCheck" : true,
      "SubnetId" : { "Fn::Select" : [ "0", {"Ref" : "Subnet"} ] }
}


  
}}}